# Установка :id=installation

Если Ваше рабочее окружение соответствует всем [минимальным требованиям](ru/getting-started/requirements.md), переходим к следующему этапу

Чтобы создать новое приложение на основе Brocket Framework, откройте ваш терминал и выполните команду:

```
composer create-project czernika/brocket <project-folder>
```

> Это позволит создать базовую структуру проекта в папке `project-folder`, установить ядро WordPress и все необходимые PHP зависимости и плагины

Затем внутри файла  `.env` в корне проекта заполните необходимые данные для подключения к базе и веб-адрес сайта. Список всех переменных и их значение внутри файла конфигурации приведен в таблице ниже. **Жирным** выделены обязательные к заполнению параметры

> Если Вы не видите файл `.env` в корне проекта, скопируйте файл `.env.example` и переименуйте его

| Переменная | Определение |
| ------ | ------ |
| **DB_NAME** | Имя базы данных |
| **DB_USER** | Пользователь базы данных |
| **DB_PASSWORD** | Пароль пользователя базы данных |
| DB_HOST | Хост базы данных |
| DB_PREFIX | Префикс таблиц базы данных |
| WP_ENV | Окружение сайта |
| **WP_HOME** | УРЛ вашего сайта (адрес, включая протокол http или https) |
| **WP_SITEURL** | УРЛ, где расположено ядро WordPress |
| WP_DEBUG_LOG | Путь к файлам логов внутри темы |
| MAIL_MAILER | Дефолтный отправщик сообщений |
| MAIL_HOST - MAIL_ENCRYPTION | Настройки произвольного SMTP хоста для отправки сообщений |
| MAIL_FROM_ADDRESS, MAIL_FROM_NAME | Адрес и имя отправителя сообщения |
| AUTH_KEY - NONCE_SALT | "Соли" WordPress |

Более подробное описание всех переменных [здесь](/ru/getting-started/env.md?id=env)

Далее необходимо будет создать базу данных, если Вы не сделали это ранее. После этого проследуйте по адресу `WP_HOME` в браузере и завершите установку сайта

### Завершение установки при помощи wp-cli :id=create-wp-cli

Для лучшего опыта разработки сайта на WordPress Вы можете установить утилиту [wp-cli](https://wp-cli.org).

> В корне проекта уже присутствует файл `wp-cli.yml`, который настроен для работы на сайте со структурой Bedrock. По умолчанию, он запрещает удалять базу, ставить плагины и создавать новых пользователей через консоль. Чтобы "нормально" и без ограничений работать в локальной среде разработки, скопируйте этот файл, переименуйте его в `wp-cli.local.yml` и уберите все ненужные команды. Этот файл будет иметь приоритет по сравнению с `wp-cli.yml`

Пример минимально необходимой конфигурации для корректной работы утилиты для сайтов со структурой Bedrock:

```yml
# wp-cli.local.yml

path: web/wp
server:
  docroot: web
```

> `wp-cli.local.yml` уже прописан внутри файла `.gitignore`, потому не следует опасаться его случайного попадания на рабочее окружение при деплое

Чтобы завершить установку проекта, перейдите в его корень и выполните команду для создания базы

```sh
cd <project-folder>

wp db create
```

!> Любые команды утилиты wp-cli следует запускать в корне проекта

Команда создаст базу данных с именем `DB_NAME` и префиксом `DB_PREFIX` для всех таблиц

Завершите установку при помощи команды

```sh
wp core install --url={url} --title={site-title} --admin_user={username} [--admin_password={password}] --admin_email={email} [--skip-email]
```

!> Параметр `--url` должен совпадать со значением `WP_HOME`

?> Вы можете сгенерировать "соли" WordPress - запустите команду `php brocooly salts:generate` или перейдите по ссылке [https://roots.io/salts.html](https://roots.io/salts.html) и вставьте сгенерированные ключи в файл `.env`. Вы также можете использовать команду `wp dotenv salts generate`, которая доступна после установки [wp-cli-dotenv-command](https://github.com/aaemnnosttv/wp-cli-dotenv-command) пакета для WP CLI

По умолчанию, Brocket устанавливается с плагином [Query Monitor](https://querymonitor.com/) для разработки. ОН используется для дебагинга Вашего сайта и выявления существующих и потенциальных проблем

> Вам также может быть интересна [статья](https://kamilgrzegorczyk.com/2018/05/02/how-to-disable-plugins-on-certain-environment/) о том, как отключить определенные плагины на определенном окружении

Чтобы иметь полный доступ ко всем возможностям плагина, запустите [следующую команду](https://github.com/johnbillion/query-monitor/wiki/db.php-Symlink#using-wp-cli)

```sh
wp qm enable
```

После этого Вы можете авторизоваться на сайте, пройдя по адресу `/wp/wp-login.php` и на этом все!

## Запуск вместе с Docker :id=docker

Brocket позволяет быстро развернуть инфраструктуру для запуска сайта с помощью Docker. Выполните команду ниже, чтобы создать необходимые файлы конфигурации - а именно, `Dockerfile`, `docker-compose.yml` и папку `docker` с настройками сервера

```sh
php brocooly vendor:docker
```

После этого Вы можете запустить контейнер командой

```sh
docker-compose up -d --build
```

!> Для запуска в Docker переменная `DB_HOST` должна иметь значение имени образа - то есть, `mysql`. Также для корректной работы сервера необходимо определить переменную `DOMAIN`

Затем измените разрешения и владельца папки `web/app/uploads` на `www-data`. Это нужно для того, чтобы пользователь сайта имел возможность загружать файлы через медиа-загрузчик из админ-панели

```sh
docker exec -it brocket-php bash

chown -R www-data:www-data /var/www/html/web/app/uploads

chmod -R 755 /var/www/html/web/app/uploads
```

### SSL :id=ssl

Чтобы запустить сайт по https-протоколу, Вы можете установить [mkcert](https://github.com/FiloSottile/mkcert), проследовать первичным настройкам пакета, а затем внутри папки `docker/nginx/certs` создать ключи сертификата

```sh
cd docker/nginx/certs

mkcert domain.name
```

Команда создаст пару ключей для домена domain.name - закрытый и открытый - которые Вы и должны подключить в файле конфигурации сервера `docker/nginx/default.conf`.

!> Если в процессе разработки Вы видите ошибку `SSL_ERROR_RX_RECORD_TOO_LONG`, откройте сайт не по адресу `localhost:3000`, а по `127.0.0.1:3000` или же в режиме инкогнито

Конечно, Вы можете изменить любую конфигурацию по своему желанию или же вовсе не использовать Docker

## Запуск рабочего окружения :id=development

Чтобы начать работать с фронт-ендом сайта, установите все необходимые зависимости командой

```sh
php brocooly vendor:mix
```

Команда создаст файлы конфигурации для работы с TailwindCSS на основе Laravel-mix. Это позволит практически мгновенно начать работу с фронтом сайта, не тратя время на развертывание системы. Однако, если Вы предпочитаете другой сборщик, Вы почти ничем не ограничены

Запустите установку зависимостей и компиляцию файлов, а также слежение за ними через команды

```sh
npm install

npm run watch
```

Сайт откроется в новой вкладке по адресу `http://localhost:3000`

![Главный экран](../../_media/screen.png)

Подробнее о работе с фронтом сайта и сборкой проекта в разделе Работа с фронтом сайта